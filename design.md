# 设计理念

> 我此过去心：任意随所欲，随爱好游行。我今悉调伏，如象师持钩，制御泌液象。

---
初学编程时，被C++的强大所震撼，沉迷于`STL`、`LOKI`、`BOOST`等各种库，并模仿这些库的风格去写代码。
经过多年的经验教训，对软件有了一些新的认知，这是我开发nmscc的初衷。

## 1. 设计：做正确的事

我们开发软件的有哪些要求？什么才是正确的事？

- 满足功能需求
- 满足研发需求
- 满足维护需求

功能需求不明确，不仅仅可能多做无用功，而且可能推翻原有架构，耗费大量时间精力。

研发需求指在可预期的人力成本下，完成研发任务，如果无视研发需求，本来项目组己经积累了Java经验，觉得C#好，不经调查就改技术栈；本该用C#/Python就可以的，非要用C++；该用第三方库的，非要自造轮子，本该项目实现的，引入了一堆痈肿的第三方库等，导致研发成本增加。

维护成本指的是未来重构、升级，或是人员变动项目交接的成本，只关心眼前利益，不重视未来，设计阶段没有前瞻性考虑，可能会导致未来重构、升级成本过大。没有统一编码准则，每个人都写得很任性，不仅给项目交接造成麻烦，甚至可能被员工留下漏洞要挟。

这三条，是设计的大方向，而采用哪些新技术，采用何种编程语言，实现得如何优雅、巧妙，都不是设计的方向。

以下举一些反例

> 某软件项目，在立项时己经知道有多国语言环境需求，但是设计阶段没有把这一项单列出来，结果代码使用了宽字符(wchar_t)，只支持本地化语言环境，后期发现问题时，己经来不及更改，只能为每种语言环境分别编译出DLL。

> 某软件项目，包含界面，数据库，算法，通信等功能，预计生命周期会在10年以上，设计时没有考虑扩展性，用VC6的MFC写的界面，数据库、算法、通信、日志等功能没有独立出来，等产品需要升级时，早期开发者己经不在岗位，新人无法把控整个架构，只能每次修修补补，过了10年需要考虑x64，GPU的时候，己经无法重构了，只能重做。

## 2. 架构：正确的做事

架构师是一个既需要掌控整体，又需要洞悉局部瓶颈，并依据具体的业务场景给出解决方案的团队领导型人物。
架构师要了解系统需求，搭建系统核心构架，划分子系统、子模块，界定边界，澄清技术细节。

架构师要从以下几方面考虑

### 2.1 编程规范

- 约定风格：比如对命名，注释的规范，保证可读性
- 约束功能：比如对某些写法、语法，某些第三方库的限制，保证可维护性

### 2.2 系统架构

- 子系统划分：子系统要有清晰的边界，强调模块内聚与模块间弱藕合，使负责相关模块的工程师更加专注，也便于后期维护
- 系统间交互：系统间的交互要考虑通用性，适用性，尽量考虑JSON/XML/ProtoBuf等通用数据交换格式，如非性能瓶颈，尽量用文本格式，尽量用文件系统做通信，通信首要确保安全可靠。

### 2.3 质量保障

- 设计文档：在开发之前，明确子系统功能，接口规范，输入输出，以文档的形式确定下来。
- 集成测试：在开发之前，搭建集成测试，用以明确系统需求。

## 3. 开发：把事做正确
